#: Title : E-Mail Services
#: Author : "Caio Abreu Ferreira" <abreuferr_gmail.com>
#: Description : Using e-mail servers
#: Options : Weight: 4

Description: Candidates should be able to manage an e-mail 
server, including the configuration of e-mail aliases, e-mail 
quotas and virtual e-mail domains. This objective includes 
configuring internal e-mail relays and monitoring e-mail servers.

Key Knowledge Areas:
- Configuration files for postfix
- Basic TLS configuration for postfix
- Basic knowledge of the SMTP protocol
- Awareness of sendmail and exim

Terms and Utilities:
- Configuration files and commands for postfix
- /etc/postfix/
- /var/spool/postfix/
- sendmail emulation layer commands
- /etc/aliases
- mail-related logs in /var/log/

#
# ATUALIZACAO DA DISTRIBUICAO
#

# atualizacao do gnu/linux debian
$ sudo apt-get update
$ sudo apt-get upgrade -y -d

#
# POSTFIX
#

# instalacao do postfix
$ sudo apt-get install postfix mailutils telnet -y -d

# reconfigurando o postfix
$ sudo dpkg-reconfigure postfix
	General type of mail configuration? - internet site
	System mail name - email.particula.local
	Root and postmaster mail recipient - cosmo
	Other destinations to accept mail for - $myhostname, email.particula.local, localhost.particula.local, , localhost
	Force synchronous updates on mail queue? - <No>
	Local networks - 127.0.0.0/8
	Mailbox size limit - 0
	Local address extension character - +
	Internet protocols to use - all

# configuracao Maildir
$ sudo postconf -e 'home_mailbox = Maildir/'

# configuracao Virtual
$ sudo postconf -e 'virtual_alias_maps= hash:/etc/postfix/virtual'
$ sudo vi /etc/postfix/virtual
	cosmo@particula.local cosmo
	support@particula.local cosmo
	postmaster@particula.local cosmo
	root@particula.local cosmo

# comando utilizado para gerar o arquivo /etc/postfix/virtual.db
$ sudo postmap /etc/postfix/virtual

# arquivo de configuracao do Postfix.
$ sudo cat /etc/postfix/main.cf
	# utilizado para especificar o hostname do servidor de email.
	myhostname = email.particula.local

	# utilizado para especificar o dominio do servidor de email.
	mydomain = particula.local

	# utilizado para especificar o dominio de origem ao qual todos 
	# os emails que serao enviados.
	myorigin = $mydomain

	# utilizado para especificar os dominios que o servidor postfix 
	# tomara como destino final.
	mydestination = $myhostname, $mydomain, localhost.particula.local, , localhost

	# utilizado para especificar quais servidores podem utilizar o
	# Postfix como relay.	
	mynetworks = 192.168.0.0/24, 127.0.0.0/8

	# utilizado para especificar o endereco ip do servidor de email (relay)
	relayhost = $myhostname
	
	# tipo de mailbox
	home_mailbox = Maildir/
	
	# endereco da interface de rede que recebe email.
	inet_interfaces = all

	# especifica o tipo de protocolo, ipv4 ou ipv6 ou os dois.
	inet_protocols = all

	# aliases
	alias_maps = hash:/etc/aliases
	alias_database = hash:/etc/aliases

	# tamanho da caixa postal.
	mailbox_size_limit = 0

	recipient_delimiter = +

	# virtual domain.
	virtual_alias_maps = hash:/etc/postfix/virtual

# reinicializando o servico do postfix
$ sudo systemctl restart postfix.service

#
# TESTE
#

# teste do postfix.
$ echo "Corpo do e-mail" | mail -s "Subject do e-mail" cosmo@particula.local

# teste smtp
$ telnet localhost 25
	ehlo localhost
	mail from: cosmo
	rcpt to: cosmo
	data
	subject: teste
	Mail body
	.
	quit
