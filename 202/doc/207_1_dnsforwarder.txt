#: Title : dns forwarder
#: Author : "Caio Abreu Ferreira" <abreuferr_gmail.com>
#: Description : Basic DNS server configuration
#: Options : Weight: 3

Description: Candidates should be able to configure BIND to function as a 
caching-only DNS server. This objective includes the ability to manage a 
running server and configuring logging.

Key Knowledge Areas:
- BIND 9.x configuration files, terms and utilities
- Defining the location of the BIND zone files in BIND configuration files
- Reloading modified configuration and zone files
- Awareness of dnsmasq, djbdns and PowerDNS as alternate name servers

The following is a partial list of the used files, terms and utilities:
- /etc/named.conf
- /var/named/
- /usr/sbin/rndc
- kill
- host
- dig

#
# INSTALACAO
#

# instalacao
$ sudo apt-get install bind9 dnsutils bind9 bind9utils bind9-doc -y -d

# alterando permissao
$ sudo chown -R bind:bind /etc/bind

#
# CONFIGURACAO
#

# configuracao do bind para ser um servidor dns forward
$ sudo vi /etc/bind/named.conf.options
	// foi criada a acl de nome "clients" como o objetivo 
	// de restringir quais hosts podem fazer a requisicao
	// de resolucao. Hosts fora desta estacao nao poderao
	// fazer requisicao de resolucao.
	acl "clients" {
		192.168.0.0/24;
	};

	options {
        	// diretorio a onde estao armazenados os arquivos de configurcao
        	directory "/etc/bind";

		// se por acaso a resposta estiver no cache, o
		// servidor ira enviar para o resolver. se por
		// acaso nao tiver a resposta, ira requisitar
		// a outro servidor a resposta da requisicao.
		recursion yes;

		// somente estacoes que estiverem na ACL poderao
		// fazer a requisicao de resolucao.
		allow-query { clients; };

		// lista de servidores dns que serao utilizados
		// para reponder a requisicao por acaso dos hosts.
		forwarders {
			8.8.8.8;
			8.8.4.4;
		};

		// o servidor ira executar somente o processo de
		// consulta, nao sera responsavel por manter uma
		// zona.
		forward only;
};

# checando os arquivos de configuracao
$ sudo named-checkconf /etc/bind/named.conf

# reinicializando o servico do bind9
$ sudo systemctl restart bind9.service

# de todas as estacoes da rede
$ sudo vi /etc/resolv.conf
	domain particula.local
	search particula.local
	nameserver 192.168.0.4

#
# TESTE
#

# (DNSCACHE)
$ sudo netstat -nltup | grep :53
$ dig kernel.org | grep time ; checar o tempo de resposta do dig

# (ESTACAO)
$ dig kernel.org | grep time ; checar o tempo de resposta do dig
