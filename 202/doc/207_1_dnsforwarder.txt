#: Title : dns forwarder
#: Author : "Caio Abreu Ferreira" <abreuferr_gmail.com>
#: Description : basic dns server configuration
#: Options : Weight: 3

Description: Candidates should be able to configure BIND to function as a 
caching-only DNS server. This objective includes the ability to manage a 
running server and configuring logging.

Key Knowledge Areas:
- BIND 9.x configuration files, terms and utilities
- Defining the location of the BIND zone files in BIND configuration files
- Reloading modified configuration and zone files
- Awareness of dnsmasq, djbdns and PowerDNS as alternate name servers

The following is a partial list of the used files, terms and utilities:
- /etc/named.conf
- /var/named/
- /usr/sbin/rndc
- kill
- host
- dig

#
# TEORIA
#

# um redirecionamento simplesmente transfere todas as
# solicitacoes feita ao servidor para outro servidor
# dns, armazenando os resultados temporariamente para
# agilizar futuras solicitacoes, semelhante a um servidor
# caching-only.
#
# o servidor do tipo forward NAO RESOLVE REQUISICAO, o
# servidor simplesmente REDIRECIONA as requisicoes para
# outros servidores e armazena o resultado em cache local.

#
# INSTALACAO
#

# atualizacao do debina
$ sudo apt-get update && sudo apt-get upgrade -y -d

# instalacao
$ sudo apt-get install bind9 dnsutils bind9 bind9utils bind9-doc -y -d

# alterando permissao
$ sudo chown -R bind:bind /etc/bind

#
# CONFIGURACAO
#

# configuracao do bind para ser um servidor dns forward
$ sudo vi /etc/bind/named.conf.options
	// foi criada a acl de nome "clients" com o objetivo 
	// de definir quais hosts pertencem a ACL. Neste caso,
	// os hosts presentes na rede 192.168.0.0/24 pertence
	// a acl CLIENTS.
	acl "clients" {
		192.168.0.0/24;
	};

	options {
        	// diretorio a onde estao armazenados os arquivos 
		// de configurcao do bind e da zona.
        	directory "/etc/bind";

		// se por acaso a resposta estiver no cache, o
		// servidor ira enviar para o resolver. se por
		// acaso nao tiver a resposta, ira requisitar
		// a outro servidor a resposta da requisicao.
		recursion yes;

		// somente estacoes que estiverem na ACL poderao
		// fazer a requisicao QUERY de resolucao de um 
		// dominio.
		allow-query { clients; };

		// o servidor do tipo FORWARDER executa somente o 
		// processo de consulta, ele nao eh responsavel por
		// manter uma zona.
		forward only;

		// lista de servidores dns que serao utilizados
		// para reponder a requisicao por parte dos hosts
		// presentes na rede definida na ACL.
		forwarders {
			8.8.8.8;
			8.8.4.4;
		};

};

# checando os arquivos de configuracao
$ sudo named-checkconf /etc/bind/named.conf.options

# utilizacao da ferramenta rndc para reler
# as configuracoes feitas no arquivo de configuracao
# do bind, named.conf.options.
$ sudo rndc reload

# comando utilizado para limpar o cache do servidor
# de nome bind.
$ sudo rndc flush

# de todas as estacoes da rede
$ sudo vi /etc/resolv.conf
	domain particula.local
	search particula.local
	nameserver 192.168.0.4

#
# TESTE
#

# (DNSFORWARD)
$ dig kernel.org | grep time

# (ESTACAO)
$ dig kernel.org | grep time
