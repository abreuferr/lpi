#: Title : dns cache
#: Author : "Caio Abreu Ferreira" <abreuferr_gmail.com>
#: Description : basic dns cache configuration
#: Options : Weight: 3

Description: Candidates should be able to configure BIND to function as a 
caching-only DNS server. This objective includes the ability to manage a 
running server and configuring logging.

Key Knowledge Areas:
- BIND 9.x configuration files, terms and utilities
- Defining the location of the BIND zone files in BIND configuration files
- Reloading modified configuration and zone files
- Awareness of dnsmasq, djbdns and PowerDNS as alternate name servers

The following is a partial list of the used files, terms and utilities:
- /etc/named.conf
- /var/named/
- /usr/sbin/rndc
- kill
- host
- dig

#
# TEORIA
#

# o servidor de dns do tipo caching eh a mais simples implementacao
# de um servidor de dns.
#
# o servidor do tipo dns caching-only resolve nomes, o qual a resposta
# eh enviada para o cliente e armazenada localmente para futuras requisicoes.
#
# o dns caching-only nao gerencia nenhuma zona.
#
# o servidor dns caching-only eh utilizado para diminuir a latencia na
# resolucao de um nome de dominio visto que as resolucoes anteriores foram 
# armazenadas localmente em cache.
#
# o caching-only tambem diminui o trafego na rede interna.

#
# INSTALACAO
#

# atualizar o debian
$ sudo apt-get update && sudo apt-get upgrade

# instalacao
$ sudo apt-get install bind9 dnsutils bind9 bind9utils bind9-doc -y -d

# alterando permissao
$ sudo chown -R bind:bind /etc/bind

#
# CONFIGURACAO
#

# configuracao geral do bind
$ sudo vi /etc/bind/named.conf.options
	// a diretiva OPTIONS tem por objetivo a de configurar opcoes
	// e padroes de configuracao de servidores de nomes globais.
	options {
		// indicando o diretorio de trabalho do bind.
		// diretorio a onde sao armazenados os arquivos
		// de configuracao da zona.
		directory "/etc/bind";

		// omite informacoes referente a versao do bind
		// por motivos de seguranca.
		version none;

		// o bind vai ficar escutando a porta 53.
		listen-on port 53 { 127.0.0.1; any; };

		// especifica quais hosts que podem fazer requisicao
		// de resolucao de nome.		
		allow-query     { localhost; any; };

		// especifica quais hosts podem ter o acesso ao cache 
		/ do bind.
		allow-query-cache       { localhost; any; };
	};

# o aplicativo named-checkconf checa a sintaxe do 
# arquivo de configuracao do bind, named.conf.
#
$ sudo named-checkconf /etc/bind/named.conf

#
# RNDC
#

# reler os arquivos de configuracao do bind
# sem interromper o servico.
#
$ sudo rndc reload

# reler o arquivo de configuracao named.conf.
#
$ sudo rndc reconfig

# obter informacoes do servidor bind.
#
$ sudo rndc status

# limpar o cache do servidor bind.
#
$ sudo rndc flush

#
# TESTE
#

# teste do cache executado no DNSCACHE
$ sudo netstat -nltup | grep :53
$ dig kernel.org | grep time

# teste do cache executado na estacao
$ dig kernel.org | grep time
