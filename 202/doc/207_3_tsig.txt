#: Title : DNS TSIG
#: Author : "Caio Abreu Ferreira" <abreuferr_gmail.com>
#: Description : Configuracao do Bind9 com a opcao de TSIG
#: Options : None

# TEORIA
#
# a funcao da tecnologia tsig eh a de prover a seguranca na comunicacao
# entre os servidores de DNS, ns1 e ns2.

# CONFIGURACAO DO DNS PRIMARIO (NS1 - 192.168.0.5)
#
$ cd /etc/bind/
$ sudo dnssec-keygen -a HMAC-MD5 -b 128 -n HOST rndc-key ; criar as chaves de criptografia
#
# -a especificar qual eh o algoritmo que sera utilizado para criar as chaves
# -b especifica o tamanho da chave
# -n especifica o tipo de chave
#
$ sudo cat Krndc-key.+157+27182.private
$ sudo vi /etc/bind/tsig.key
    key "TRANSFER" {
              algorithm hmac-md5;
              secret "B72d9UgSPcSt6BMmMg5F6w==";
    };

    server 192.168.0.6 {
	    keys {
		    TRANSFER;
	    };
    };

$ sudo vi /etc/bind/named.conf.local
    include "/etc/bind/tsig.key";
$ sudo systemctl restart bind9.service

# CONFIGURACAO DO DNS SECUNDARIO (NS2 - 192.168.0.6)
#
$ sudo vi /etc/bind/tsig.key
    key "TRANSFER" {
              algorithm hmac-md5;
              secret "B72d9UgSPcSt6BMmMg5F6w==";
    };

    server 192.168.0.5 {
	    keys {
		    TRANSFER;
	    };
    };

$ sudo vi /etc/bind/named.conf.local
    include "/etc/bind/tsig.key";

$ sudo systemctl restart bind9.service

# CONFIGURACAO DO DNS PRIMARIO (NS1 - 192.168.0.5)
#
$ sudo vi /etc/bind/named.conf.local
    // Master zones
    zone "particula.local" {
            type master;
            file "/etc/bind/db.particula.local";
            allow-transfer { key TRANSFER; };
            notify yes;
    };

$ sudo systemctl restart bind9.service
